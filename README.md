# easy-registry
üê≥ Kit for creating safe docker registry with basic http auth

–î–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ docker-registry –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è:
* [Docker](https://docs.docker.com/install) –∏ [docker-compose](https://docs.docker.com/compose/install)
* SSL-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç. –õ—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –æ—Ç [letsencrypt](https://letsencrypt.org), –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ [certbot](https://certbot.eff.org)
* [Nginx](https://nginx.org) –¥–ª—è –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –∑–∞–ø—É—â–µ–Ω–Ω—ã–π registry –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä

–°–Ω–∞—á–∞–ª–∞ –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Ö–æ—Å—Ç —Å –∫–æ—Ç–æ—Ä–æ–≥–æ –∑–∞–ø—Ä–æ—Å—ã –±—É–¥–µ–º –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä.
–ö–æ–Ω—Ñ–∏–≥ nginx'a –º–æ–∂–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫:
``` nginx
 server {
    server_name registry.host.com;
    location / {
        proxy_set_header X-Forwarded-Host $host;
        proxy_set_header X-Forwarded-Server $host;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_pass https://localhost:5000;
        client_max_body_size 100M;
    }
}
```

–¢–µ–ø–µ—Ä—å –¥–ª—è —Ö–æ—Å—Ç–∞ –Ω—É–∂–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç. –í—ã–ø–æ–ª–Ω—è–µ–º –≤ –∫–æ–Ω—Å–æ–ª–∏ `sudo certbot` –∏ —Å–ª–µ–¥—É–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –±–æ—Ç–∞.

–ö–ª–æ–Ω–∏—Ä—É–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π: `git clone https://github.com/1g0rbm/easy-registry.git`. –î–∞–ª–µ–µ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –≤ —Å–∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é, –≤—ã–ø–æ–ª–Ω—è–µ–º –∫–æ–º–∞–Ω–¥—É `cp .env.dist .env` –∏ –æ—Ç–∫—Ä—ã–≤–∞–µ–º `.env` –Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ.

–í —Å–µ–∫—Ü–∏–∏ `replace this values` –Ω—É–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞ —Å–≤–æ–∏ –∑–Ω–∞—á–µ–Ω–∏—è:
``` config
PATH_TO_REGISTRY_DIR=/var/www/registry.host.com # –ø—É—Ç—å –¥–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –∫—É–¥–∞ —Å–∫–ª–æ–Ω–∏—Ä–æ–≤–Ω —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
PATH_TO_CERTS=/etc/letsencrypt/archive/registry.host.com # –ø—É—Ç—å –¥–æ –¥–∏—Ä–µ—Ç–æ—Ä–∏–∏ —Å —Ñ–∞–π–ª–∞–º–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ (–¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ—Ç –∂–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —á—Ç–æ –∏ –¥–ª—è —Ö–æ—Å—Ç–∞)
```

–¢–µ–ø–µ—Ä—å –Ω—É–∂–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å –¥–ª—è basic http auth. –ó–∞–ø—É—Å–∫–∞–µ–º –∫–æ–º–∞–Ω–¥—ã `make prepare_scripts` –∏ `make basic_http_auth`. –°–∫—Ä–∏–ø—Ç –ø—Ä–µ–¥–ª–æ–∂–∏—Ç –≤–≤–µ—Å—Ç–∏ –ª–æ–≥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –ø–∞—Ä–æ–ª—å.

–î–∞–ª–µ–µ –Ω—É–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä registry —á–µ—Ä–µ–∑ docker-compose: `docker-compose up -d`.
